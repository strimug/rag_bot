"""
Конфигурация для Telegram-бота с RAG на основе OpenAI API.

Этот модуль содержит все настройки для работы бота:
- Токены доступа к Telegram и OpenAI
- Модели для эмбеддингов и генерации текста
- Пути к файлам и базам данных
"""

import os
from pathlib import Path
from dotenv import load_dotenv

# Загружаем переменные окружения из файла .env
load_dotenv()

# ========== TELEGRAM НАСТРОЙКИ ==========
# Токен бота получаем от @BotFather в Telegram
TELEGRAM_TOKEN = os.getenv("TELEGRAM_TOKEN", "")
if not TELEGRAM_TOKEN:
    raise ValueError("TELEGRAM_TOKEN не установлен в переменных окружения!")

# ========== OPENAI НАСТРОЙКИ ==========
# API ключ от OpenAI (https://platform.openai.com/api-keys)
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY", "")
if not OPENAI_API_KEY:
    raise ValueError("OPENAI_API_KEY не установлен в переменных окружения!")

# Модель для создания эмбеддингов (векторных представлений текста)
# text-embedding-3-small - быстрая и эффективная модель от OpenAI
EMBED_MODEL = "text-embedding-3-small"

# Модель для генерации ответов (чат)
# gpt-4o-mini - оптимальное соотношение качества и скорости
CHAT_MODEL = "gpt-4o-mini"

# Модель для обработки изображений (vision)
VISION_MODEL = "gpt-4o-mini"

# ========== FAISS НАСТРОЙКИ ==========
# Путь к индексному файлу FAISS (векторная база данных)
BASE_DIR = Path(__file__).parent
FAISS_INDEX_PATH = BASE_DIR / "index.faiss"

# Путь к файлу с метаданными (тексты документов)
FAISS_METADATA_PATH = BASE_DIR / "metadata.json"

# Путь к директории с документами для индексации
DOCS_PATH = BASE_DIR.parent / "data" / "docs"

# ========== RAG НАСТРОЙКИ ==========
# Количество документов для извлечения из базы знаний
TOP_K_RESULTS = 3

# Максимальная длина контекста (в символах)
MAX_CONTEXT_LENGTH = 3000

# ========== ПРОМПТЫ ==========
# Системный промпт для RAG-ассистента
SYSTEM_PROMPT = """Ты — интеллектуальный ассистент с доступом к базе знаний.
Твоя задача — отвечать на вопросы пользователей, опираясь на предоставленный контекст из базы знаний и историю разговора.

Правила работы:
1. Используй информацию из контекста базы знаний для формирования ответа
2. Учитывай историю предыдущих сообщений для понимания контекста разговора
3. Если пользователь спрашивает про "это", "то", "предыдущий вопрос" - смотри в историю сообщений выше
4. Если в контексте нет информации для ответа, честно скажи об этом
5. Отвечай на русском языке четко и структурированно
6. Если уместно, используй списки и пункты для лучшей читаемости
7. Будь вежливым и профессиональным
"""

# Шаблон для формирования промпта с контекстом
RAG_PROMPT_TEMPLATE = """Контекст из базы знаний:
{context}

Вопрос пользователя: {query}

Ответ:"""

# ========== ЛОГИРОВАНИЕ ==========
# Уровень логирования (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL = "INFO"

# Формат сообщений в логах
LOG_FORMAT = "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

